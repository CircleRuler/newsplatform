[{"type":"js","data":"/* Imports for global scope */\n\nMongo = Package.mongo.Mongo;\nReactiveVar = Package['reactive-var'].ReactiveVar;\n$ = Package.jquery.$;\njQuery = Package.jquery.jQuery;\nTracker = Package.tracker.Tracker;\nDeps = Package.tracker.Deps;\nSession = Package.session.Session;\nMeteor = Package.meteor.Meteor;\nglobal = Package.meteor.global;\nmeteorEnv = Package.meteor.meteorEnv;\nWebApp = Package.webapp.WebApp;\n_ = Package.underscore._;\nDDP = Package['ddp-client'].DDP;\nLaunchScreen = Package['launch-screen'].LaunchScreen;\nBlaze = Package.ui.Blaze;\nUI = Package.ui.UI;\nHandlebars = Package.ui.Handlebars;\nSpacebars = Package.spacebars.Spacebars;\nTemplate = Package.templating.Template;\nmeteorInstall = Package.modules.meteorInstall;\nBuffer = Package.modules.Buffer;\nprocess = Package.modules.process;\nSymbol = Package['ecmascript-runtime'].Symbol;\nMap = Package['ecmascript-runtime'].Map;\nSet = Package['ecmascript-runtime'].Set;\nmeteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;\nPromise = Package.promise.Promise;\nAccounts = Package['accounts-base'].Accounts;\nShowdown = Package.markdown.Showdown;\nAutoupdate = Package.autoupdate.Autoupdate;\nReload = Package.reload.Reload;\nHTML = Package.htmljs.HTML;\n\n","servePath":"/packages/global-imports.js"},{"type":"js","data":"var require = meteorInstall({\"client\":{\"template.client.js\":function(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                               //\n// client/template.client.js                                                                                     //\n//                                                                                                               //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                 //\n                                                                                                                 // 1\nTemplate.body.addContent((function() {                                                                           // 2\n  var view = this;                                                                                               // 3\n  return [ Spacebars.include(view.lookupTemplate(\"nav\")), \"\\n    \", Spacebars.include(view.lookupTemplate(\"container\")), \"\\n    \", Spacebars.include(view.lookupTemplate(\"footer\")) ];\n}));                                                                                                             // 5\nMeteor.startup(Template.body.renderToDocument);                                                                  // 6\n                                                                                                                 // 7\nTemplate.__checkName(\"nav\");                                                                                     // 8\nTemplate[\"nav\"] = new Template(\"Template.nav\", (function() {                                                     // 9\n  var view = this;                                                                                               // 10\n  return HTML.DIV({                                                                                              // 11\n    \"class\": \"navbar navbar-inverse navbar-fixed-top\"                                                            // 12\n  }, \"\\n        \", HTML.DIV({                                                                                    // 13\n    \"class\": \"navbar-inner\"                                                                                      // 14\n  }, \"\\n            \", HTML.DIV({                                                                                // 15\n    \"class\": \"container\"                                                                                         // 16\n  }, \"\\n                \", HTML.Raw('<a class=\"btn btn-navbar\" data-toggle=\"collapse\" data-target=\".nav-collapse\">\\n                    <span class=\"icon-bar\"></span>\\n                    <span class=\"icon-bar\"></span>\\n                    <span class=\"icon-bar\"></span>\\n                </a>'), \"\\n                \", HTML.Raw('<a href=\"/\" class=\"brand\">新闻爆料</a>'), \"\\n                \", HTML.DIV({\n    \"class\": \"nav-collapse\"                                                                                      // 18\n  }, \"\\n                    \", HTML.UL({                                                                         // 19\n    \"class\": \"nav\"                                                                                               // 20\n  }, \"\\n                        \", HTML.LI({                                                                     // 21\n    \"class\": function() {                                                                                        // 22\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"lists\"));                                  // 23\n    }                                                                                                            // 24\n  }, HTML.Raw('<a href=\"/lists\" style=\"font-weight: bold;color:#eee;font-size: 18px;\">排行榜</a>')), \"\\n                        \", HTML.LI({\n    \"class\": function() {                                                                                        // 26\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"index\"));                                  // 27\n    }                                                                                                            // 28\n  }, HTML.Raw('<a href=\"/\">首页</a>')), \"\\n                        \", Blaze.If(function() {                        // 29\n    return Spacebars.call(view.lookup(\"currentUser\"));                                                           // 30\n  }, function() {                                                                                                // 31\n    return [ \"\\n                            \", HTML.LI({                                                         // 32\n      \"class\": function() {                                                                                      // 33\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"self\"));                                 // 34\n      }                                                                                                          // 35\n    }, HTML.A({                                                                                                  // 36\n      href: \"/self\"                                                                                              // 37\n    }, Blaze.View(\"lookup:currentUser.username\", function() {                                                    // 38\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"currentUser\"), \"username\"));                          // 39\n    }))), \"\\n                            \", HTML.LI({                                                            // 40\n      \"class\": function() {                                                                                      // 41\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"friend\"));                               // 42\n      }                                                                                                          // 43\n    }, HTML.A({                                                                                                  // 44\n      href: \"/friend\"                                                                                            // 45\n    }, \"好友\")), \"\\n                            \", HTML.LI(HTML.A({                                                // 46\n      href: \"/logout\"                                                                                            // 47\n    }, \"登出\")), \"\\n                        \" ];                                                                   // 48\n  }, function() {                                                                                                // 49\n    return [ \"\\n                            \", HTML.LI({                                                         // 50\n      \"class\": function() {                                                                                      // 51\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"login\"));                                // 52\n      }                                                                                                          // 53\n    }, HTML.A({                                                                                                  // 54\n      href: \"/login\"                                                                                             // 55\n    }, \"登入\")), \"\\n                            \", HTML.LI({                                                       // 56\n      \"class\": function() {                                                                                      // 57\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"reg\"));                                  // 58\n      }                                                                                                          // 59\n    }, HTML.A({                                                                                                  // 60\n      href: \"/reg\"                                                                                               // 61\n    }, \"注册\")), \"\\n                        \" ];                                                                   // 62\n  }), \"\\n                    \"), \"\\n                \"), \"\\n            \"), \"\\n        \"), \"\\n    \");             // 63\n}));                                                                                                             // 64\n                                                                                                                 // 65\nTemplate.__checkName(\"container\");                                                                               // 66\nTemplate[\"container\"] = new Template(\"Template.container\", (function() {                                         // 67\n  var view = this;                                                                                               // 68\n  return HTML.DIV({                                                                                              // 69\n    id: \"container\",                                                                                             // 70\n    \"class\": \"container\"                                                                                         // 71\n  }, \"\\n        \", Spacebars.include(view.lookupTemplate(\"info\")), \"\\n        \", Blaze.If(function() {           // 72\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"index\"));                                    // 73\n  }, function() {                                                                                                // 74\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"index\")), \"\\n        \" ];                  // 75\n  }), \"\\n        \", Blaze.If(function() {                                                                        // 76\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"login\"));                                    // 77\n  }, function() {                                                                                                // 78\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"login\")), \"\\n        \" ];                  // 79\n  }), \"\\n        \", Blaze.If(function() {                                                                        // 80\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"reg\"));                                      // 81\n  }, function() {                                                                                                // 82\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"reg\")), \"\\n        \" ];                    // 83\n  }), \"\\n        \", Blaze.If(function() {                                                                        // 84\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"self\"));                                     // 85\n  }, function() {                                                                                                // 86\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"self\")), \"\\n        \" ];                   // 87\n  }), \"\\n        \", Blaze.If(function() {                                                                        // 88\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"friend\"));                                   // 89\n  }, function() {                                                                                                // 90\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"friend\")), \"\\n        \" ];                 // 91\n  }), \"\\n        \", Blaze.If(function() {                                                                        // 92\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"lists\"));                                    // 93\n  }, function() {                                                                                                // 94\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"lists\")), \"\\n        \" ];                  // 95\n  }), \"\\n    \");                                                                                                 // 96\n}));                                                                                                             // 97\n                                                                                                                 // 98\nTemplate.__checkName(\"footer\");                                                                                  // 99\nTemplate[\"footer\"] = new Template(\"Template.footer\", (function() {                                               // 100\n  var view = this;                                                                                               // 101\n  return HTML.Raw('<p class=\"muted text-center\">Newsplatform 2016</p>');                                         // 102\n}));                                                                                                             // 103\n                                                                                                                 // 104\nTemplate.__checkName(\"info\");                                                                                    // 105\nTemplate[\"info\"] = new Template(\"Template.info\", (function() {                                                   // 106\n  var view = this;                                                                                               // 107\n  return [ Blaze.If(function() {                                                                                 // 108\n    return Spacebars.call(Spacebars.dot(view.lookup(\"info\"), \"success\"));                                        // 109\n  }, function() {                                                                                                // 110\n    return [ \"\\n        \", HTML.DIV({                                                                            // 111\n      \"class\": \"alert alert-success\"                                                                             // 112\n    }, Blaze.View(\"lookup:info.success\", function() {                                                            // 113\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"info\"), \"success\"));                                  // 114\n    })), \"\\n    \" ];                                                                                             // 115\n  }), \"\\n    \", Blaze.If(function() {                                                                            // 116\n    return Spacebars.call(Spacebars.dot(view.lookup(\"info\"), \"error\"));                                          // 117\n  }, function() {                                                                                                // 118\n    return [ \"\\n        \", HTML.DIV({                                                                            // 119\n      \"class\": \"alert alert-error\"                                                                               // 120\n    }, Blaze.View(\"lookup:info.error\", function() {                                                              // 121\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"info\"), \"error\"));                                    // 122\n    })), \"\\n    \" ];                                                                                             // 123\n  }) ];                                                                                                          // 124\n}));                                                                                                             // 125\n                                                                                                                 // 126\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"template.index.js\":function(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                               //\n// client/template.index.js                                                                                      //\n//                                                                                                               //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                 //\n                                                                                                                 // 1\nTemplate.__checkName(\"index\");                                                                                   // 2\nTemplate[\"index\"] = new Template(\"Template.index\", (function() {                                                 // 3\n  var view = this;                                                                                               // 4\n  return [ Blaze.If(function() {                                                                                 // 5\n    return Spacebars.call(view.lookup(\"currentUser\"));                                                           // 6\n  }, function() {                                                                                                // 7\n    return [ \"\\n        \", HTML.FORM({                                                                           // 8\n      action: \"\",                                                                                                // 9\n      \"class\": \"well form-inline center\",                                                                        // 10\n      style: \"text-align:center;\"                                                                                // 11\n    }, \"\\n            \", HTML.TEXTAREA({                                                                         // 12\n      \"class\": \"span8\",                                                                                          // 13\n      id: \"post\"                                                                                                 // 14\n    }), \"\\n            \", HTML.BUTTON({                                                                          // 15\n      id: \"submit\",                                                                                              // 16\n      \"class\": \"btn btn-success\"                                                                                 // 17\n    }, \"发表\"), \"\\n        \"), \"\\n    \" ];                                                                         // 18\n  }, function() {                                                                                                // 19\n    return [ \"\\n        \", HTML.H2(\"游客无法发布新闻或者评论。请注册或者登陆。\"), \"\\n    \" ];                                         // 20\n  }), \"\\n    \", Blaze.Each(function() {                                                                          // 21\n    return Spacebars.call(view.lookup(\"posts\"));                                                                 // 22\n  }, function() {                                                                                                // 23\n    return [ \"\\n        \", HTML.H2(Blaze.View(\"lookup:user.username\", function() {                               // 24\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"username\"));                                 // 25\n    }), \" \", HTML.BUTTON({                                                                                       // 26\n      id: \"addFriend\",                                                                                           // 27\n      \"class\": \"btn\"                                                                                             // 28\n    }, \"加好友\"), \":\"), \"\\n        \", HTML.P({                                                                      // 29\n      \"class\": \"muted\"                                                                                           // 30\n    }, Blaze.View(\"lookup:time\", function() {                                                                    // 31\n      return Spacebars.mustache(view.lookup(\"time\"));                                                            // 32\n    })), \"\\n        \", HTML.P(Spacebars.include(view.lookupTemplate(\"markdown\"), function() {                    // 33\n      return Blaze.View(\"lookup:post\", function() {                                                              // 34\n        return Spacebars.mustache(view.lookup(\"post\"));                                                          // 35\n      });                                                                                                        // 36\n    })), \"\\n        \", Blaze.If(function() {                                                                     // 37\n      return Spacebars.call(view.lookup(\"currentUser\"));                                                         // 38\n    }, function() {                                                                                              // 39\n      return [ \"\\n            \", HTML.P(\"\\n            \", HTML.INPUT({                                           // 40\n        type: \"text\",                                                                                            // 41\n        \"class\": \"span8\",                                                                                        // 42\n        id: function() {                                                                                         // 43\n          return Spacebars.mustache(Spacebars.dot(view.lookup(\".\"), \"_id\"));                                     // 44\n        }                                                                                                        // 45\n      }), \"\\n            \", HTML.BUTTON({                                                                        // 46\n        id: \"commnetSubmit\",                                                                                     // 47\n        \"class\": \"btn btn-success\"                                                                               // 48\n      }, \"评论\"), \"\\n            \"), \"\\n        \" ];                                                               // 49\n    }), \"\\n        \", Blaze.Each(function() {                                                                    // 50\n      return Spacebars.call(view.lookup(\"comments\"));                                                            // 51\n    }, function() {                                                                                              // 52\n      return [ \"\\n            \", HTML.P(Blaze.View(\"lookup:user.username\", function() {                          // 53\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"username\"));                               // 54\n      }), \" 评论: \", Blaze.View(\"lookup:post\", function() {                                                        // 55\n        return Spacebars.mustache(view.lookup(\"post\"));                                                          // 56\n      })), \"\\n        \" ];                                                                                       // 57\n    }), \"\\n    \" ];                                                                                              // 58\n  }) ];                                                                                                          // 59\n}));                                                                                                             // 60\n                                                                                                                 // 61\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"template.lists.js\":function(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                               //\n// client/template.lists.js                                                                                      //\n//                                                                                                               //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                 //\n                                                                                                                 // 1\nTemplate.__checkName(\"lists\");                                                                                   // 2\nTemplate[\"lists\"] = new Template(\"Template.lists\", (function() {                                                 // 3\n  var view = this;                                                                                               // 4\n  return Blaze.Each(function() {                                                                                 // 5\n    return Spacebars.call(view.lookup(\"lists\"));                                                                 // 6\n  }, function() {                                                                                                // 7\n    return [ \"\\n        \", HTML.LI(HTML.SPAN(\"第\", Blaze.View(\"lookup:rank\", function() {                         // 8\n      return Spacebars.mustache(view.lookup(\"rank\"));                                                            // 9\n    }), \"名\"), HTML.SPAN(Blaze.View(\"lookup:user.username\", function() {                                          // 10\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"username\"));                                 // 11\n    })), HTML.SPAN(\"总分是\", Blaze.View(\"lookup:totalScore\", function() {                                           // 12\n      return Spacebars.mustache(view.lookup(\"totalScore\"));                                                      // 13\n    }))), \"\\n    \" ];                                                                                            // 14\n  });                                                                                                            // 15\n}));                                                                                                             // 16\n                                                                                                                 // 17\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"template.login.js\":function(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                               //\n// client/template.login.js                                                                                      //\n//                                                                                                               //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                 //\n                                                                                                                 // 1\nTemplate.__checkName(\"login\");                                                                                   // 2\nTemplate[\"login\"] = new Template(\"Template.login\", (function() {                                                 // 3\n  var view = this;                                                                                               // 4\n  return HTML.Raw('<form action=\"\" class=\"form-horizontal\">\\n        <fieldset>\\n            <legend>用户登入</legend>\\n            <div class=\"control-group\">\\n                <label for=\"username\" class=\"control-label\">用户名</label>\\n                <div class=\"controls\">\\n                    <input type=\"text\" id=\"username\" class=\"input-xlarge\" name=\"username\" required=\"\">\\n                </div>\\n            </div>\\n            <div class=\"control-group\">\\n                <label for=\"password\" class=\"control-label\">密码</label>\\n                <div class=\"controls\">\\n                    <input type=\"password\" name=\"password\" class=\"input-xlarge\" id=\"password\" required=\"\">\\n                </div>\\n            </div>\\n            <div class=\"form-actions\">\\n                <button id=\"submit\" class=\"btn btn-primary\">登入</button>\\n            </div>\\n        </fieldset>\\n    </form>');\n}));                                                                                                             // 6\n                                                                                                                 // 7\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"template.reg.js\":function(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                               //\n// client/template.reg.js                                                                                        //\n//                                                                                                               //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                 //\n                                                                                                                 // 1\nTemplate.__checkName(\"reg\");                                                                                     // 2\nTemplate[\"reg\"] = new Template(\"Template.reg\", (function() {                                                     // 3\n  var view = this;                                                                                               // 4\n  return HTML.FORM({                                                                                             // 5\n    action: \"\",                                                                                                  // 6\n    \"class\": \"form-horizontal\"                                                                                   // 7\n  }, \"\\n        \", HTML.FIELDSET(\"\\n            \", HTML.getTag(\"lengend\")(\"用户注册\"), \"\\n            \", HTML.Raw('<div class=\"control-group\">\\n                <label for=\"username\" class=\"control-label\">用户名</label>\\n                <div class=\"controls\">\\n                    <input type=\"text\" id=\"username\" class=\"input-xlarge\" name=\"username\" required=\"\" autocomplete=\"false\">\\n                </div>\\n            </div>'), \"\\n            \", HTML.Raw('<div class=\"control-group\">\\n                <label for=\"useremail\" class=\"control-label\">邮箱</label>\\n                <div class=\"controls\">\\n                    <input type=\"text\" id=\"useremail\" class=\"input-xlarge\" name=\"useremail\" required=\"\" autocomplete=\"false\">\\n                </div>\\n            </div>'), \"\\n            \", HTML.Raw('<div class=\"control-group\">\\n                <label for=\"password\" class=\"control-label\">密码</label>\\n                <div class=\"controls\">\\n                    <input type=\"password\" class=\"input-xlarge\" id=\"password\" name=\"password\" required=\"\">\\n                </div>\\n            </div>'), \"\\n            \", HTML.Raw('<div class=\"control-group\">\\n                <label for=\"password-repeat\" class=\"control-label\">重复输入密码</label>\\n                <div class=\"controls\">\\n                    <input type=\"password\" name=\"password-repeat\" class=\"input-xlarge\" id=\"password-repeat\" required=\"\">\\n                </div>\\n            </div>'), \"\\n            \", HTML.Raw('<div class=\"form-actions\">\\n                <button id=\"submit\" class=\"btn btn-primary\">注册</button>\\n            </div>'), \"\\n        \"), \"\\n    \");\n}));                                                                                                             // 9\n                                                                                                                 // 10\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"template.self.js\":function(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                               //\n// client/template.self.js                                                                                       //\n//                                                                                                               //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                 //\n                                                                                                                 // 1\nTemplate.__checkName(\"self\");                                                                                    // 2\nTemplate[\"self\"] = new Template(\"Template.self\", (function() {                                                   // 3\n  var view = this;                                                                                               // 4\n  return Blaze.Each(function() {                                                                                 // 5\n    return Spacebars.call(view.lookup(\"self\"));                                                                  // 6\n  }, function() {                                                                                                // 7\n    return [ \"\\n        \", Blaze.If(function() {                                                                 // 8\n      return Spacebars.call(view.lookup(\"isAdmin\"));                                                             // 9\n    }, function() {                                                                                              // 10\n      return [ \"\\n            \", HTML.H1(\"尊贵的管理员账户！\"), \"\\n        \" ];                                           // 11\n    }, function() {                                                                                              // 12\n      return [ \"\\n            \", HTML.H4(\"普通用户。\"), \"\\n        \" ];                                               // 13\n    }), \"\\n        \", HTML.LI(\"用户名：\", Blaze.View(\"lookup:user.username\", function() {                            // 14\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"username\"));                                 // 15\n    })), \"\\n        \", HTML.LI(\"注册邮箱：\", Blaze.View(\"lookup:user.emails.0.address\", function() {                  // 16\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"emails\", \"0\", \"address\"));                   // 17\n    })), \"\\n        \", HTML.LI(\"总积分：\", Blaze.View(\"lookup:totalScore\", function() {                              // 18\n      return Spacebars.mustache(view.lookup(\"totalScore\"));                                                      // 19\n    })), \"\\n        \", HTML.LI(\"今日积分：\", Blaze.View(\"lookup:todayScore\", function() {                             // 20\n      return Spacebars.mustache(view.lookup(\"todayScore\"));                                                      // 21\n    })), \"\\n        \", HTML.LI(\"好友总数：\", Blaze.View(\"lookup:totalFriend\", function() {                            // 22\n      return Spacebars.mustache(view.lookup(\"totalFriend\"));                                                     // 23\n    })), \"\\n        \", HTML.LI(\"排名：\", Blaze.View(\"lookup:rank\", function() {                                     // 24\n      return Spacebars.mustache(view.lookup(\"rank\"));                                                            // 25\n    })), \"\\n        \", HTML.LI(\"注册时间：\", Blaze.View(\"lookup:time\", function() {                                   // 26\n      return Spacebars.mustache(view.lookup(\"time\"));                                                            // 27\n    })), \"\\n    \" ];                                                                                             // 28\n  });                                                                                                            // 29\n}));                                                                                                             // 30\n                                                                                                                 // 31\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"client.js\":function(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                               //\n// client/client.js                                                                                              //\n//                                                                                                               //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                 //\nSession.setDefault(\"currentUrl\", { index: \"active\", login: \"\", reg: \"\", friend: \"\", lists: \"\", self: \"\" });      // 1\nSession.setDefault(\"info\", { success: \"\", error: \"\" });                                                          // 2\nPosts = new Meteor.Collection(\"posts\");                                                                          // 3\nSystemInfo = new Meteor.Collection(\"systemInfo\");                                                                // 4\nUserInfo = new Meteor.Collection(\"userInfo\");                                                                    // 5\n                                                                                                                 //\nTemplate.info.helpers({                                                                                          // 7\n    info: function () {                                                                                          // 8\n        function info() {                                                                                        //\n            return Session.get(\"info\");                                                                          // 9\n        }                                                                                                        //\n                                                                                                                 //\n        return info;                                                                                             //\n    }()                                                                                                          //\n});                                                                                                              //\n                                                                                                                 //\nTemplate.container.helpers({                                                                                     // 13\n    currentUrl: function () {                                                                                    // 14\n        function currentUrl() {                                                                                  //\n            return Session.get(\"currentUrl\");                                                                    // 15\n        }                                                                                                        //\n                                                                                                                 //\n        return currentUrl;                                                                                       //\n    }()                                                                                                          //\n});                                                                                                              //\n                                                                                                                 //\nTemplate.nav.helpers({                                                                                           // 19\n    active: function () {                                                                                        // 20\n        function active() {                                                                                      //\n            return Session.get(\"currentUrl\");                                                                    // 21\n        }                                                                                                        //\n                                                                                                                 //\n        return active;                                                                                           //\n    }()                                                                                                          //\n});                                                                                                              //\n                                                                                                                 //\nTemplate.index.helpers({                                                                                         // 25\n    posts: function () {                                                                                         // 26\n        function posts() {                                                                                       //\n            if (!Meteor.userId()) {                                                                              // 27\n                return Posts.find({ \"user._id\": \"NAEQJhrKe79xtC8Hd\", \"super\": 0 }, { sort: { time: -1 } });      // 28\n            } else {                                                                                             //\n                return Posts.find({ \"super\": 0 }, { sort: { time: -1 } });                                       // 30\n            }                                                                                                    //\n        }                                                                                                        //\n                                                                                                                 //\n        return posts;                                                                                            //\n    }(),                                                                                                         //\n    comments: function () {                                                                                      // 33\n        function comments() {                                                                                    //\n            return Posts.find({ \"super\": this._id }, { sort: { time: -1 } });                                    // 34\n        }                                                                                                        //\n                                                                                                                 //\n        return comments;                                                                                         //\n    }()                                                                                                          //\n});                                                                                                              //\n                                                                                                                 //\nTemplate.lists.helpers({                                                                                         // 38\n    lists: function () {                                                                                         // 39\n        function lists() {                                                                                       //\n            return UserInfo.find({}, { sort: { rank: 1 } });                                                     // 40\n        }                                                                                                        //\n                                                                                                                 //\n        return lists;                                                                                            //\n    }()                                                                                                          //\n});                                                                                                              //\n                                                                                                                 //\nTemplate.self.helpers({                                                                                          // 44\n    self: function () {                                                                                          // 45\n        function self() {                                                                                        //\n            return UserInfo.find({ \"user._id\": Meteor.userId() });                                               // 46\n        }                                                                                                        //\n                                                                                                                 //\n        return self;                                                                                             //\n    }()                                                                                                          //\n});                                                                                                              //\n                                                                                                                 //\nMeteor.startup(function () {                                                                                     // 50\n    Backbone.history.start({ pushState: true });                                                                 // 51\n});                                                                                                              //\n                                                                                                                 //\nvar urlRouter = Backbone.Router.extend({                                                                         // 54\n    routes: {                                                                                                    // 55\n        \"\": \"index\",                                                                                             // 56\n        \"login\": \"login\",                                                                                        // 57\n        \"reg\": \"reg\",                                                                                            // 58\n        \"logout\": \"logout\",                                                                                      // 59\n        \"friend\": \"friend\",                                                                                      // 60\n        \"lists\": \"lists\",                                                                                        // 61\n        \"self\": \"self\"                                                                                           // 62\n    },                                                                                                           //\n    index: function () {                                                                                         // 64\n        function index() {                                                                                       // 64\n            Session.set(\"currentUrl\", { index: \"active\", login: \"\", reg: \"\", friend: \"\", lists: \"\", self: \"\" });\n        }                                                                                                        //\n                                                                                                                 //\n        return index;                                                                                            //\n    }(),                                                                                                         //\n    friend: function () {                                                                                        // 67\n        function friend() {                                                                                      // 67\n            Session.set(\"currentUrl\", { index: \"\", login: \"\", reg: \"\", friend: \"active\", lists: \"\", self: \"\" });\n        }                                                                                                        //\n                                                                                                                 //\n        return friend;                                                                                           //\n    }(),                                                                                                         //\n    lists: function () {                                                                                         // 70\n        function lists() {                                                                                       // 70\n            Session.set(\"currentUrl\", { index: \"\", login: \"\", reg: \"\", friend: \"\", lists: \"active\", self: \"\" });\n        }                                                                                                        //\n                                                                                                                 //\n        return lists;                                                                                            //\n    }(),                                                                                                         //\n    self: function () {                                                                                          // 73\n        function self() {                                                                                        // 73\n            Session.set(\"currentUrl\", { index: \"\", login: \"\", reg: \"\", friend: \"\", lists: \"\", self: \"active\" });\n        }                                                                                                        //\n                                                                                                                 //\n        return self;                                                                                             //\n    }(),                                                                                                         //\n    login: function () {                                                                                         // 76\n        function login() {                                                                                       // 76\n            if (Meteor.userId()) {                                                                               // 77\n                this.navigate(\"/\", true);                                                                        // 78\n                Session.set(\"info\", { success: \"\", error: \"用户已在线！\" });                                           // 79\n            }                                                                                                    //\n            Session.set(\"currentUrl\", { index: \"\", login: \"active\", reg: \"\", friend: \"\", lists: \"\", self: \"\" });\n        }                                                                                                        //\n                                                                                                                 //\n        return login;                                                                                            //\n    }(),                                                                                                         //\n    reg: function () {                                                                                           // 83\n        function reg() {                                                                                         // 83\n            if (Meteor.userId()) {                                                                               // 84\n                this.navigate(\"/\", true);                                                                        // 85\n                Session.set(\"info\", { success: \"\", error: \"用户已在线！\" });                                           // 86\n            }                                                                                                    //\n            Session.set(\"currentUrl\", { index: \"\", login: \"\", reg: \"active\", friend: \"\", lists: \"\", self: \"\" });\n        }                                                                                                        //\n                                                                                                                 //\n        return reg;                                                                                              //\n    }(),                                                                                                         //\n    logout: function () {                                                                                        // 90\n        function logout() {                                                                                      // 90\n            if (Meteor.userId()) {                                                                               // 91\n                Meteor.logout();                                                                                 // 92\n                this.navigate(\"/\", true);                                                                        // 93\n                Session.set(\"info\", { success: \"登出成功\", error: \"\" });                                             // 94\n                SystemInfo.update({ \"_id\": \"1\" }, { $inc: { totalLogin: -1 } });                                 // 95\n            } else {                                                                                             //\n                this.navigate(\"/\", true);                                                                        // 97\n                Session.set(\"info\", { success: \"\", error: \"用户不在线！\" });                                           // 98\n            }                                                                                                    //\n        }                                                                                                        //\n                                                                                                                 //\n        return logout;                                                                                           //\n    }(),                                                                                                         //\n    redirect: function () {                                                                                      // 101\n        function redirect(url) {                                                                                 // 101\n            this.navigate(url, true);                                                                            // 102\n        }                                                                                                        //\n                                                                                                                 //\n        return redirect;                                                                                         //\n    }()                                                                                                          //\n});                                                                                                              //\nRouter = new urlRouter();                                                                                        // 105\n                                                                                                                 //\nTemplate.reg.events({                                                                                            // 107\n    'click #submit': function () {                                                                               // 108\n        function clickSubmit(event) {                                                                            // 108\n            event.preventDefault();                                                                              // 109\n            if (!SystemInfo.find({ \"_id\": \"1\" }, { totalUser: true })['totalUser']) {                            // 110\n                SystemInfo.insert({ \"_id\": \"1\", \"totalUser\": 0, \"totalPost\": 0, \"totalLogin\": 0 });              // 111\n            }                                                                                                    //\n            var $username = $(\"#username\").val();                                                                // 113\n            var $password = $(\"#password\").val();                                                                // 114\n            var $useremail = $(\"#useremail\").val();                                                              // 115\n            var $password_repeat = $(\"#password-repeat\").val();                                                  // 116\n            if ($password.length === 0 || $username.length === 0) {                                              // 117\n                Session.set(\"info\", { success: \"\", error: \"用户名或者密码不能为空\" });                                      // 118\n                return;                                                                                          // 119\n            }                                                                                                    //\n            if ($password !== $password_repeat) {                                                                // 121\n                Session.set(\"info\", { success: \"\", error: \"两次输入密码不一致\" });                                        // 122\n                return;                                                                                          // 123\n            }                                                                                                    //\n            Accounts.createUser({                                                                                // 125\n                username: $username,                                                                             // 126\n                password: $password,                                                                             // 127\n                email: $useremail }, function (err) {                                                            // 128\n                if (err) {                                                                                       // 130\n                    Session.set(\"info\", { success: \"\", error: \"注册失败\" });                                         // 131\n                } else {                                                                                         //\n                    Session.set(\"info\", { success: \"注册成功\", error: \"\" });                                         // 133\n                    UserInfo.insert({                                                                            // 134\n                        user: Meteor.user(),                                                                     // 135\n                        isAdmin: false,                                                                          // 136\n                        totalScore: 0,                                                                           // 137\n                        todayScore: 0,                                                                           // 138\n                        totalFriend: 0,                                                                          // 139\n                        rank: SystemInfo.findOne({ \"_id\": \"1\" }, { totalUser: true })[\"totalUser\"],              // 140\n                        time: new Date()                                                                         // 141\n                    });                                                                                          //\n                }                                                                                                //\n            });                                                                                                  //\n            SystemInfo.update({ \"_id\": \"1\" }, { $inc: { \"totalUser\": 1 } });                                     // 146\n            SystemInfo.update({ \"_id\": \"1\" }, { $inc: { \"totalLogin\": 1 } });                                    // 147\n        }                                                                                                        //\n                                                                                                                 //\n        return clickSubmit;                                                                                      //\n    }()                                                                                                          //\n});                                                                                                              //\n                                                                                                                 //\nTemplate.login.events({                                                                                          // 151\n    'click #submit': function () {                                                                               // 152\n        function clickSubmit(event) {                                                                            // 152\n            event.preventDefault();                                                                              // 153\n            var $username = $(\"#username\").val();                                                                // 154\n            var $password = $(\"#password\").val();                                                                // 155\n            if ($password.length === 0 || $username.length === 0) {                                              // 156\n                Session.set(\"info\", { success: \"\", error: \"用户名或密码不能为空\" });                                       // 157\n                return;                                                                                          // 158\n            }                                                                                                    //\n            Meteor.loginWithPassword($username, $password, function (err) {                                      // 160\n                if (err) {                                                                                       // 161\n                    Session.set(\"info\", { success: \"\", error: \"登陆失败！用户名与密码不匹配。\" });                              // 162\n                } else {                                                                                         //\n                    Router.redirect(\"/\");                                                                        // 164\n                    SystemInfo.update({ \"_id\": \"1\" }, { $inc: { \"totalLogin\": 1 } });                            // 165\n                    Session.set(\"info\", { success: \"登陆成功\", error: \"\" });                                         // 166\n                }                                                                                                //\n            });                                                                                                  //\n        }                                                                                                        //\n                                                                                                                 //\n        return clickSubmit;                                                                                      //\n    }()                                                                                                          //\n});                                                                                                              //\n                                                                                                                 //\nTemplate.index.events({                                                                                          // 172\n    'click #submit': function () {                                                                               // 173\n        function clickSubmit(event) {                                                                            // 173\n            event.preventDefault();                                                                              // 174\n            var $post = $(\"#post\").val();                                                                        // 175\n            if ($post.length === 0 || $post.length >= 200) {                                                     // 176\n                Session.set(\"info\", { success: \"\", error: \"请将字数限制在1-200字以内\" });                                  // 177\n                return;                                                                                          // 178\n            }                                                                                                    //\n            Posts.insert({                                                                                       // 180\n                user: Meteor.user(),                                                                             // 181\n                post: $post,                                                                                     // 182\n                \"super\": 0,                                                                                      // 183\n                time: new Date() }, function (err) {                                                             // 184\n                if (err) {                                                                                       // 186\n                    Session.set(\"info\", { success: \"\", error: \"发表失败，原因自寻\" });                                    // 187\n                } else {                                                                                         //\n                    Session.set(\"info\", { success: \"发表成功\", error: \"\" });                                         // 189\n                    $(\"#post\").val(\"\");                                                                          // 190\n                }                                                                                                //\n            });                                                                                                  //\n            SystemInfo.update({ \"_id\": \"1\" }, { $inc: { \"totalPost\": 1 } });                                     // 194\n        }                                                                                                        //\n                                                                                                                 //\n        return clickSubmit;                                                                                      //\n    }(),                                                                                                         //\n    'click #commnetSubmit': function () {                                                                        // 196\n        function clickCommnetSubmit(event) {                                                                     // 196\n            event.preventDefault();                                                                              // 197\n            var $comment = $(\"#\" + this._id).val();                                                              // 198\n            if ($comment.length === 0 || $comment.length >= 100) {                                               // 199\n                Session.set(\"info\", { success: \"\", error: \"请将字数限制在1-100字以内\" });                                  // 200\n                return;                                                                                          // 201\n            }                                                                                                    //\n            Posts.insert({                                                                                       // 203\n                user: Meteor.user(),                                                                             // 204\n                post: $comment,                                                                                  // 205\n                \"super\": this._id,                                                                               // 206\n                time: new Date() }, function (err) {                                                             // 207\n                if (err) {                                                                                       // 209\n                    Session.set(\"info\", { success: \"\", error: \"评论失败，原因自寻\" });                                    // 210\n                } else {                                                                                         //\n                    Session.set(\"info\", { success: \"评论成功\", error: \"\" });                                         // 212\n                    $(\"#\" + this._id).val(\"\");                                                                   // 213\n                }                                                                                                //\n            });                                                                                                  //\n            SystemInfo.update({ \"_id\": \"1\" }, { $inc: { \"totalPost\": 1 } });                                     // 217\n        }                                                                                                        //\n                                                                                                                 //\n        return clickCommnetSubmit;                                                                               //\n    }(),                                                                                                         //\n    'click #addFriend': function () {                                                                            // 219\n        function clickAddFriend(event) {                                                                         // 219\n            event.preventDefault();                                                                              // 220\n            var $friendId = this.user._id;                                                                       // 221\n            console.log($friendId);                                                                              // 222\n            console.log(this._id);                                                                               // 223\n            // if ($comment.length === 0 || $comment.length >= 100) {                                            //\n            //     Session.set(\"info\", {success:\"\", error:\"请将字数限制在1-100字以内\"});                                   //\n            //     return;                                                                                       //\n            // }                                                                                                 //\n                                                                                                                 //\n            UserInfo.update({                                                                                    // 219\n                \"user._id\": Meteor.userId()                                                                      // 230\n            }, {                                                                                                 //\n                $addToSet: { \"Friends\": $friendId },                                                             // 232\n                $inc: { \"totalFriend\": 1 }                                                                       // 233\n            }, true, true, function (err) {                                                                      //\n                if (err) {                                                                                       // 237\n                    Session.set(\"info\", { success: \"\", error: \"添加好友失败\" });                                       // 238\n                } else {                                                                                         //\n                    Session.set(\"info\", { success: \"添加成功\", error: \"\" });                                         // 240\n                }                                                                                                //\n            });                                                                                                  //\n        }                                                                                                        //\n                                                                                                                 //\n        return clickAddFriend;                                                                                   //\n    }()                                                                                                          //\n});                                                                                                              //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},{\"extensions\":[\".js\",\".json\",\".html\",\".css\"]});\nrequire(\"./client/template.client.js\");\nrequire(\"./client/template.index.js\");\nrequire(\"./client/template.lists.js\");\nrequire(\"./client/template.login.js\");\nrequire(\"./client/template.reg.js\");\nrequire(\"./client/template.self.js\");\nrequire(\"./client/client.js\");","servePath":"/app.js","sourceMap":{"version":3,"sources":["/client/template.client.js","/client/template.index.js","/client/template.lists.js","/client/template.login.js","/client/template.reg.js","/client/template.self.js","/client/client.js"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uH;;;;;;;;;;;AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sH;;;;;;;;;;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sH;;;;;;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA,qH;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sH;;;;;;;;;;;ACTA;AACA;AACA;AACA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","file":"/app.js","sourcesContent":["\nTemplate.body.addContent((function() {\n  var view = this;\n  return [ Spacebars.include(view.lookupTemplate(\"nav\")), \"\\n    \", Spacebars.include(view.lookupTemplate(\"container\")), \"\\n    \", Spacebars.include(view.lookupTemplate(\"footer\")) ];\n}));\nMeteor.startup(Template.body.renderToDocument);\n\nTemplate.__checkName(\"nav\");\nTemplate[\"nav\"] = new Template(\"Template.nav\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"navbar navbar-inverse navbar-fixed-top\"\n  }, \"\\n        \", HTML.DIV({\n    \"class\": \"navbar-inner\"\n  }, \"\\n            \", HTML.DIV({\n    \"class\": \"container\"\n  }, \"\\n                \", HTML.Raw('<a class=\"btn btn-navbar\" data-toggle=\"collapse\" data-target=\".nav-collapse\">\\n                    <span class=\"icon-bar\"></span>\\n                    <span class=\"icon-bar\"></span>\\n                    <span class=\"icon-bar\"></span>\\n                </a>'), \"\\n                \", HTML.Raw('<a href=\"/\" class=\"brand\">新闻爆料</a>'), \"\\n                \", HTML.DIV({\n    \"class\": \"nav-collapse\"\n  }, \"\\n                    \", HTML.UL({\n    \"class\": \"nav\"\n  }, \"\\n                        \", HTML.LI({\n    \"class\": function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"lists\"));\n    }\n  }, HTML.Raw('<a href=\"/lists\" style=\"font-weight: bold;color:#eee;font-size: 18px;\">排行榜</a>')), \"\\n                        \", HTML.LI({\n    \"class\": function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"index\"));\n    }\n  }, HTML.Raw('<a href=\"/\">首页</a>')), \"\\n                        \", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"currentUser\"));\n  }, function() {\n    return [ \"\\n                            \", HTML.LI({\n      \"class\": function() {\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"self\"));\n      }\n    }, HTML.A({\n      href: \"/self\"\n    }, Blaze.View(\"lookup:currentUser.username\", function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"currentUser\"), \"username\"));\n    }))), \"\\n                            \", HTML.LI({\n      \"class\": function() {\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"friend\"));\n      }\n    }, HTML.A({\n      href: \"/friend\"\n    }, \"好友\")), \"\\n                            \", HTML.LI(HTML.A({\n      href: \"/logout\"\n    }, \"登出\")), \"\\n                        \" ];\n  }, function() {\n    return [ \"\\n                            \", HTML.LI({\n      \"class\": function() {\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"login\"));\n      }\n    }, HTML.A({\n      href: \"/login\"\n    }, \"登入\")), \"\\n                            \", HTML.LI({\n      \"class\": function() {\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"active\"), \"reg\"));\n      }\n    }, HTML.A({\n      href: \"/reg\"\n    }, \"注册\")), \"\\n                        \" ];\n  }), \"\\n                    \"), \"\\n                \"), \"\\n            \"), \"\\n        \"), \"\\n    \");\n}));\n\nTemplate.__checkName(\"container\");\nTemplate[\"container\"] = new Template(\"Template.container\", (function() {\n  var view = this;\n  return HTML.DIV({\n    id: \"container\",\n    \"class\": \"container\"\n  }, \"\\n        \", Spacebars.include(view.lookupTemplate(\"info\")), \"\\n        \", Blaze.If(function() {\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"index\"));\n  }, function() {\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"index\")), \"\\n        \" ];\n  }), \"\\n        \", Blaze.If(function() {\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"login\"));\n  }, function() {\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"login\")), \"\\n        \" ];\n  }), \"\\n        \", Blaze.If(function() {\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"reg\"));\n  }, function() {\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"reg\")), \"\\n        \" ];\n  }), \"\\n        \", Blaze.If(function() {\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"self\"));\n  }, function() {\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"self\")), \"\\n        \" ];\n  }), \"\\n        \", Blaze.If(function() {\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"friend\"));\n  }, function() {\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"friend\")), \"\\n        \" ];\n  }), \"\\n        \", Blaze.If(function() {\n    return Spacebars.call(Spacebars.dot(view.lookup(\"currentUrl\"), \"lists\"));\n  }, function() {\n    return [ \"\\n            \", Spacebars.include(view.lookupTemplate(\"lists\")), \"\\n        \" ];\n  }), \"\\n    \");\n}));\n\nTemplate.__checkName(\"footer\");\nTemplate[\"footer\"] = new Template(\"Template.footer\", (function() {\n  var view = this;\n  return HTML.Raw('<p class=\"muted text-center\">Newsplatform 2016</p>');\n}));\n\nTemplate.__checkName(\"info\");\nTemplate[\"info\"] = new Template(\"Template.info\", (function() {\n  var view = this;\n  return [ Blaze.If(function() {\n    return Spacebars.call(Spacebars.dot(view.lookup(\"info\"), \"success\"));\n  }, function() {\n    return [ \"\\n        \", HTML.DIV({\n      \"class\": \"alert alert-success\"\n    }, Blaze.View(\"lookup:info.success\", function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"info\"), \"success\"));\n    })), \"\\n    \" ];\n  }), \"\\n    \", Blaze.If(function() {\n    return Spacebars.call(Spacebars.dot(view.lookup(\"info\"), \"error\"));\n  }, function() {\n    return [ \"\\n        \", HTML.DIV({\n      \"class\": \"alert alert-error\"\n    }, Blaze.View(\"lookup:info.error\", function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"info\"), \"error\"));\n    })), \"\\n    \" ];\n  }) ];\n}));\n","\nTemplate.__checkName(\"index\");\nTemplate[\"index\"] = new Template(\"Template.index\", (function() {\n  var view = this;\n  return [ Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"currentUser\"));\n  }, function() {\n    return [ \"\\n        \", HTML.FORM({\n      action: \"\",\n      \"class\": \"well form-inline center\",\n      style: \"text-align:center;\"\n    }, \"\\n            \", HTML.TEXTAREA({\n      \"class\": \"span8\",\n      id: \"post\"\n    }), \"\\n            \", HTML.BUTTON({\n      id: \"submit\",\n      \"class\": \"btn btn-success\"\n    }, \"发表\"), \"\\n        \"), \"\\n    \" ];\n  }, function() {\n    return [ \"\\n        \", HTML.H2(\"游客无法发布新闻或者评论。请注册或者登陆。\"), \"\\n    \" ];\n  }), \"\\n    \", Blaze.Each(function() {\n    return Spacebars.call(view.lookup(\"posts\"));\n  }, function() {\n    return [ \"\\n        \", HTML.H2(Blaze.View(\"lookup:user.username\", function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"username\"));\n    }), \" \", HTML.BUTTON({\n      id: \"addFriend\",\n      \"class\": \"btn\"\n    }, \"加好友\"), \":\"), \"\\n        \", HTML.P({\n      \"class\": \"muted\"\n    }, Blaze.View(\"lookup:time\", function() {\n      return Spacebars.mustache(view.lookup(\"time\"));\n    })), \"\\n        \", HTML.P(Spacebars.include(view.lookupTemplate(\"markdown\"), function() {\n      return Blaze.View(\"lookup:post\", function() {\n        return Spacebars.mustache(view.lookup(\"post\"));\n      });\n    })), \"\\n        \", Blaze.If(function() {\n      return Spacebars.call(view.lookup(\"currentUser\"));\n    }, function() {\n      return [ \"\\n            \", HTML.P(\"\\n            \", HTML.INPUT({\n        type: \"text\",\n        \"class\": \"span8\",\n        id: function() {\n          return Spacebars.mustache(Spacebars.dot(view.lookup(\".\"), \"_id\"));\n        }\n      }), \"\\n            \", HTML.BUTTON({\n        id: \"commnetSubmit\",\n        \"class\": \"btn btn-success\"\n      }, \"评论\"), \"\\n            \"), \"\\n        \" ];\n    }), \"\\n        \", Blaze.Each(function() {\n      return Spacebars.call(view.lookup(\"comments\"));\n    }, function() {\n      return [ \"\\n            \", HTML.P(Blaze.View(\"lookup:user.username\", function() {\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"username\"));\n      }), \" 评论: \", Blaze.View(\"lookup:post\", function() {\n        return Spacebars.mustache(view.lookup(\"post\"));\n      })), \"\\n        \" ];\n    }), \"\\n    \" ];\n  }) ];\n}));\n","\nTemplate.__checkName(\"lists\");\nTemplate[\"lists\"] = new Template(\"Template.lists\", (function() {\n  var view = this;\n  return Blaze.Each(function() {\n    return Spacebars.call(view.lookup(\"lists\"));\n  }, function() {\n    return [ \"\\n        \", HTML.LI(HTML.SPAN(\"第\", Blaze.View(\"lookup:rank\", function() {\n      return Spacebars.mustache(view.lookup(\"rank\"));\n    }), \"名\"), HTML.SPAN(Blaze.View(\"lookup:user.username\", function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"username\"));\n    })), HTML.SPAN(\"总分是\", Blaze.View(\"lookup:totalScore\", function() {\n      return Spacebars.mustache(view.lookup(\"totalScore\"));\n    }))), \"\\n    \" ];\n  });\n}));\n","\nTemplate.__checkName(\"login\");\nTemplate[\"login\"] = new Template(\"Template.login\", (function() {\n  var view = this;\n  return HTML.Raw('<form action=\"\" class=\"form-horizontal\">\\n        <fieldset>\\n            <legend>用户登入</legend>\\n            <div class=\"control-group\">\\n                <label for=\"username\" class=\"control-label\">用户名</label>\\n                <div class=\"controls\">\\n                    <input type=\"text\" id=\"username\" class=\"input-xlarge\" name=\"username\" required=\"\">\\n                </div>\\n            </div>\\n            <div class=\"control-group\">\\n                <label for=\"password\" class=\"control-label\">密码</label>\\n                <div class=\"controls\">\\n                    <input type=\"password\" name=\"password\" class=\"input-xlarge\" id=\"password\" required=\"\">\\n                </div>\\n            </div>\\n            <div class=\"form-actions\">\\n                <button id=\"submit\" class=\"btn btn-primary\">登入</button>\\n            </div>\\n        </fieldset>\\n    </form>');\n}));\n","\nTemplate.__checkName(\"reg\");\nTemplate[\"reg\"] = new Template(\"Template.reg\", (function() {\n  var view = this;\n  return HTML.FORM({\n    action: \"\",\n    \"class\": \"form-horizontal\"\n  }, \"\\n        \", HTML.FIELDSET(\"\\n            \", HTML.getTag(\"lengend\")(\"用户注册\"), \"\\n            \", HTML.Raw('<div class=\"control-group\">\\n                <label for=\"username\" class=\"control-label\">用户名</label>\\n                <div class=\"controls\">\\n                    <input type=\"text\" id=\"username\" class=\"input-xlarge\" name=\"username\" required=\"\" autocomplete=\"false\">\\n                </div>\\n            </div>'), \"\\n            \", HTML.Raw('<div class=\"control-group\">\\n                <label for=\"useremail\" class=\"control-label\">邮箱</label>\\n                <div class=\"controls\">\\n                    <input type=\"text\" id=\"useremail\" class=\"input-xlarge\" name=\"useremail\" required=\"\" autocomplete=\"false\">\\n                </div>\\n            </div>'), \"\\n            \", HTML.Raw('<div class=\"control-group\">\\n                <label for=\"password\" class=\"control-label\">密码</label>\\n                <div class=\"controls\">\\n                    <input type=\"password\" class=\"input-xlarge\" id=\"password\" name=\"password\" required=\"\">\\n                </div>\\n            </div>'), \"\\n            \", HTML.Raw('<div class=\"control-group\">\\n                <label for=\"password-repeat\" class=\"control-label\">重复输入密码</label>\\n                <div class=\"controls\">\\n                    <input type=\"password\" name=\"password-repeat\" class=\"input-xlarge\" id=\"password-repeat\" required=\"\">\\n                </div>\\n            </div>'), \"\\n            \", HTML.Raw('<div class=\"form-actions\">\\n                <button id=\"submit\" class=\"btn btn-primary\">注册</button>\\n            </div>'), \"\\n        \"), \"\\n    \");\n}));\n","\nTemplate.__checkName(\"self\");\nTemplate[\"self\"] = new Template(\"Template.self\", (function() {\n  var view = this;\n  return Blaze.Each(function() {\n    return Spacebars.call(view.lookup(\"self\"));\n  }, function() {\n    return [ \"\\n        \", Blaze.If(function() {\n      return Spacebars.call(view.lookup(\"isAdmin\"));\n    }, function() {\n      return [ \"\\n            \", HTML.H1(\"尊贵的管理员账户！\"), \"\\n        \" ];\n    }, function() {\n      return [ \"\\n            \", HTML.H4(\"普通用户。\"), \"\\n        \" ];\n    }), \"\\n        \", HTML.LI(\"用户名：\", Blaze.View(\"lookup:user.username\", function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"username\"));\n    })), \"\\n        \", HTML.LI(\"注册邮箱：\", Blaze.View(\"lookup:user.emails.0.address\", function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"emails\", \"0\", \"address\"));\n    })), \"\\n        \", HTML.LI(\"总积分：\", Blaze.View(\"lookup:totalScore\", function() {\n      return Spacebars.mustache(view.lookup(\"totalScore\"));\n    })), \"\\n        \", HTML.LI(\"今日积分：\", Blaze.View(\"lookup:todayScore\", function() {\n      return Spacebars.mustache(view.lookup(\"todayScore\"));\n    })), \"\\n        \", HTML.LI(\"好友总数：\", Blaze.View(\"lookup:totalFriend\", function() {\n      return Spacebars.mustache(view.lookup(\"totalFriend\"));\n    })), \"\\n        \", HTML.LI(\"排名：\", Blaze.View(\"lookup:rank\", function() {\n      return Spacebars.mustache(view.lookup(\"rank\"));\n    })), \"\\n        \", HTML.LI(\"注册时间：\", Blaze.View(\"lookup:time\", function() {\n      return Spacebars.mustache(view.lookup(\"time\"));\n    })), \"\\n    \" ];\n  });\n}));\n","Session.setDefault(\"currentUrl\", {index: \"active\", login: \"\", reg: \"\",friend:\"\",lists:\"\",self:\"\"});\r\nSession.setDefault(\"info\", {success:\"\",error:\"\"});\r\nPosts = new Meteor.Collection(\"posts\");\r\nSystemInfo = new Meteor.Collection(\"systemInfo\");\r\nUserInfo = new Meteor.Collection(\"userInfo\");\r\n\r\nTemplate.info.helpers({\r\n    info(){\r\n        return Session.get(\"info\");\r\n    },\r\n});\r\n\r\nTemplate.container.helpers({\r\n    currentUrl(){\r\n        return Session.get(\"currentUrl\");\r\n    },\r\n});\r\n\r\nTemplate.nav.helpers({\r\n    active(){\r\n        return Session.get(\"currentUrl\");\r\n    },\r\n});\r\n\r\nTemplate.index.helpers({\r\n    posts(){\r\n        if(!Meteor.userId()){\r\n            return Posts.find({\"user._id\":\"NAEQJhrKe79xtC8Hd\",\"super\":0},{sort: {time: -1}});\r\n        }else{\r\n            return Posts.find({\"super\":0},{sort: {time: -1}});\r\n        }\r\n    },\r\n    comments(){\r\n        return Posts.find({\"super\":this._id},{sort: {time: -1}});\r\n    },\r\n});\r\n\r\nTemplate.lists.helpers({\r\n    lists(){\r\n        return UserInfo.find({},{sort: {rank: 1}})\r\n    },\r\n});\r\n\r\nTemplate.self.helpers({\r\n    self(){\r\n        return UserInfo.find({\"user._id\":Meteor.userId()});\r\n    },\r\n});\r\n\r\nMeteor.startup(function () {\r\n    Backbone.history.start({pushState: true});\r\n});\r\n\r\nvar urlRouter = Backbone.Router.extend({\r\n    routes: {\r\n        \"\": \"index\",\r\n        \"login\": \"login\",\r\n        \"reg\": \"reg\",\r\n        \"logout\": \"logout\",\r\n        \"friend\": \"friend\",\r\n        \"lists\": \"lists\",\r\n        \"self\": \"self\"\r\n    },\r\n    index: function () {\r\n        Session.set(\"currentUrl\", {index: \"active\", login: \"\", reg: \"\",friend:\"\",lists:\"\",self:\"\"});\r\n    },\r\n    friend: function () {\r\n        Session.set(\"currentUrl\", {index: \"\", login: \"\", reg: \"\",friend:\"active\",lists:\"\",self:\"\"});\r\n    },\r\n    lists: function () {\r\n        Session.set(\"currentUrl\", {index: \"\", login: \"\", reg: \"\",friend:\"\",lists:\"active\",self:\"\"});\r\n    },\r\n    self: function () {\r\n        Session.set(\"currentUrl\", {index: \"\", login: \"\", reg: \"\",friend:\"\",lists:\"\",self:\"active\"});\r\n    },\r\n    login: function () {\r\n        if(Meteor.userId()){\r\n            this.navigate(\"/\",true);\r\n            Session.set(\"info\", {success:\"\", error: \"用户已在线！\"});\r\n        }\r\n        Session.set(\"currentUrl\", {index: \"\", login:\"active\", reg: \"\",friend:\"\",lists:\"\",self:\"\"});\r\n    },\r\n    reg: function () {\r\n        if(Meteor.userId()){\r\n            this.navigate(\"/\",true);\r\n            Session.set(\"info\", {success:\"\", error: \"用户已在线！\"});\r\n        }\r\n        Session.set(\"currentUrl\", {index: \"\", login: \"\", reg: \"active\",friend:\"\",lists:\"\",self:\"\"});\r\n    },\r\n    logout: function () {\r\n        if(Meteor.userId()){\r\n            Meteor.logout();\r\n            this.navigate(\"/\",true);\r\n            Session.set(\"info\", {success:\"登出成功\", error: \"\"});\r\n            SystemInfo.update({\"_id\":\"1\"},{$inc: {totalLogin:-1}});\r\n        }else{\r\n            this.navigate(\"/\",true);\r\n            Session.set(\"info\", {success:\"\", error: \"用户不在线！\"});\r\n        }\r\n    },\r\n    redirect: function(url){\r\n        this.navigate(url, true);\r\n    }\r\n});\r\nRouter = new urlRouter;\r\n\r\nTemplate.reg.events({\r\n    'click #submit': function (event) {\r\n        event.preventDefault();\r\n        if(!SystemInfo.find({\"_id\":\"1\"},{totalUser:true})['totalUser']){\r\n            SystemInfo.insert({\"_id\":\"1\",\"totalUser\":0,\"totalPost\":0,\"totalLogin\":0});\r\n        }\r\n        var $username = $(\"#username\").val();\r\n        var $password = $(\"#password\").val();\r\n        var $useremail = $(\"#useremail\").val();\r\n        var $password_repeat = $(\"#password-repeat\").val();\r\n        if ($password.length === 0 || $username.length === 0) {\r\n            Session.set(\"info\", {success: \"\", error:\"用户名或者密码不能为空\"});\r\n            return;\r\n        }\r\n        if ($password !== $password_repeat) {\r\n            Session.set(\"info\", {success: \"\",error:\"两次输入密码不一致\"});\r\n            return;\r\n        }\r\n        Accounts.createUser({\r\n            username: $username,\r\n            password: $password,\r\n            email: $useremail},\r\n            function(err){\r\n                if(err){\r\n                    Session.set(\"info\", {success:\"\", error:\"注册失败\"});\r\n                }else{\r\n                    Session.set(\"info\", {success:\"注册成功\", error:\"\"});\r\n                    UserInfo.insert({\r\n                        user:Meteor.user(),\r\n                        isAdmin:false,\r\n                        totalScore:0,\r\n                        todayScore:0,\r\n                        totalFriend:0,\r\n                        rank:SystemInfo.findOne({\"_id\":\"1\"},{totalUser:true})[\"totalUser\"],\r\n                        time:new Date()\r\n                    });\r\n                }\r\n            }\r\n        );\r\n        SystemInfo.update({\"_id\":\"1\"},{$inc: {\"totalUser\":1}});\r\n        SystemInfo.update({\"_id\":\"1\"},{$inc: {\"totalLogin\":1}});\r\n    }\r\n});\r\n\r\nTemplate.login.events({\r\n    'click #submit': function (event) {\r\n        event.preventDefault();\r\n        var $username = $(\"#username\").val();\r\n        var $password = $(\"#password\").val();\r\n        if ($password.length === 0 || $username.length === 0) {\r\n            Session.set(\"info\", {success:\"\", error: \"用户名或密码不能为空\"});\r\n            return;\r\n        } \r\n        Meteor.loginWithPassword($username, $password, function (err) {\r\n            if(err){\r\n                Session.set(\"info\", {success:\"\", error:\"登陆失败！用户名与密码不匹配。\"});\r\n            }else{\r\n                Router.redirect(\"/\");\r\n                SystemInfo.update({\"_id\":\"1\"},{$inc: {\"totalLogin\":1}});\r\n                Session.set(\"info\", {success: \"登陆成功\", error:\"\"});\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\nTemplate.index.events({\r\n    'click #submit':function (event) {\r\n        event.preventDefault();\r\n        var $post = $(\"#post\").val();\r\n        if ($post.length === 0 || $post.length >= 200) {\r\n            Session.set(\"info\", {success:\"\", error:\"请将字数限制在1-200字以内\"});\r\n            return;\r\n        }\r\n        Posts.insert({\r\n            user: Meteor.user(), \r\n            post: $post, \r\n            super:0,\r\n            time:new Date()},\r\n            function(err){\r\n                if(err){\r\n                    Session.set(\"info\", {success:\"\", error:\"发表失败，原因自寻\"});\r\n                }else{\r\n                    Session.set(\"info\", {success:\"发表成功\", error:\"\"});\r\n                    $(\"#post\").val(\"\");\r\n                }\r\n            }\r\n        );\r\n        SystemInfo.update({\"_id\":\"1\"},{$inc: {\"totalPost\":1}});\r\n    },\r\n    'click #commnetSubmit':function (event) {\r\n        event.preventDefault();\r\n        var $comment = $(\"#\"+this._id).val();\r\n        if ($comment.length === 0 || $comment.length >= 100) {\r\n            Session.set(\"info\", {success:\"\", error:\"请将字数限制在1-100字以内\"});\r\n            return;\r\n        }\r\n        Posts.insert({\r\n            user: Meteor.user(), \r\n            post: $comment, \r\n            super:this._id,\r\n            time:new Date()},\r\n            function(err){\r\n                if(err){\r\n                    Session.set(\"info\", {success:\"\", error:\"评论失败，原因自寻\"});\r\n                }else{\r\n                    Session.set(\"info\", {success:\"评论成功\", error:\"\"});\r\n                    $(\"#\"+this._id).val(\"\");\r\n                }\r\n            }\r\n        );\r\n        SystemInfo.update({\"_id\":\"1\"},{$inc: {\"totalPost\":1}});\r\n    },\r\n    'click #addFriend':function (event) {\r\n        event.preventDefault();\r\n        var $friendId = this.user._id;\r\n        console.log($friendId);\r\n        console.log(this._id)\r\n        // if ($comment.length === 0 || $comment.length >= 100) {\r\n        //     Session.set(\"info\", {success:\"\", error:\"请将字数限制在1-100字以内\"});\r\n        //     return;\r\n        // }\r\n\r\n        UserInfo.update({\r\n                \"user._id\":Meteor.userId()\r\n            },{\r\n                $addToSet:{\"Friends\":$friendId},\r\n                $inc:{\"totalFriend\":1}\r\n            },\r\n            true,true,\r\n            function(err){\r\n                if(err){\r\n                    Session.set(\"info\", {success:\"\", error:\"添加好友失败\"});\r\n                }else{\r\n                    Session.set(\"info\", {success:\"添加成功\", error:\"\"});\r\n                }\r\n            }\r\n        );\r\n    }\r\n})\r\n"]}}]